<% @issues_board.view = self %>
<% if @issue_card.saved_changes? %>
  <% if @issue_card.closed? %>
    $('#issue-<%= @issue_card.id %>').addClass('closed');
    $('#issue-<%= @issue_card.id %>').find('a.issue').addClass('closed');
  <% else %>
    $('#issue-<%= @issue_card.id %>').removeClass('closed');
    $('#issue-<%= @issue_card.id %>').find('a.issue').removeClass('closed');
  <% end %>
  // refresh status total
  $('#issues-count-on-status-<%= @issue_card.status_id_before_last_save %>').html('<%= @issues_board.issues.select { |i| i.status_id == @issue_card.status_id_before_last_save }.count %>');
  $('#issues-count-on-status-<%= @issue_card.status_id %>').html('<%= @issues_board.issues.select { |i| i.status_id == @issue_card.status_id }.count %>');
  // refresh group total
  <% @issues_board.grouped_issues do |_, _, group_css, issues_in_group| %>
    $('#issues-count-on-group-<%= group_css %>').html('<%= issues_in_group.count %>');
  <% end %>
  // refresh issues board
  $('.issue-card-receiver').sortable('destroy');
  loadSortableBoard();
<% else %>
  <% if flash[:error].present? %>
  alert('<%= raw(escape_javascript(flash[:error])) %>');
  <% end %>
  $('.issue-card-receiver').sortable('cancel');
<% end %>
